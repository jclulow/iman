#!/bin/bash

#
# iman [-s SECTION] PAGE: open illumos man pages from the OS X command line.
# Looks for the "links" text browser by default, but falls back to "open" to use
# the default browser.
#

function usage
{
	[[ -n "$@" ]] && echo "$(basename $0): $@" >&2
	echo "usage: iman [-s SECTION] PAGE" >&2
	exit 2;
}

base="http://illumos.org/man"
url="$base"
useopen="false"
lookup=""

while getopts ":s:o" c "$@"; do
	case "$c" in
	s)	lookup="$OPTARG/" ;;
	o)	useopen="true" ;;
	:)      usage "option requires an argument -- $OPTARG"  ;;
	*)      usage "invalid option -- $OPTARG"  ;;
	esac
done

shift $(( $OPTIND - 1 ))
[[ -n "$1" ]] || usage

lookup="$lookup$1"
echo "$url/$lookup"

if [[ $useopen != "true" ]]; then
	curl -s "$url/__raw/$lookup" | ${PAGER:-more}
else
	open "$url/$lookup"
fi
